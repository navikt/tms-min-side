---
import { getAudience, getOboToken } from "../../utils/server/token";
import { fetchHtml } from "../../utils/server/fetch";

interface Props {
  url: string;
  appname: string;
  namespace: string;
  fallback: string;
  language: string;
}

const { url, appname, namespace, fallback, language } = Astro.props;
const audience = getAudience(appname, namespace);
const oboToken = await getOboToken(Astro.locals.token, audience);

let html;

try {
  html = await fetchHtml(oboToken, `${url}/${language}`);
} catch (error) {
  console.error(`Failed to fetch microfrontend: ${appname}. Error: `, error);
}
---

<Fragment set:html={html} />
