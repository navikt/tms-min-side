---
import { getAudience, getOboToken } from "../../utils/server/token";
import ClientError from "../client-error/ClientError";
import { navnUrl } from "./personaliaUrls";
import { fetchData } from "../../utils/server/fetch";
import style from "./Personalia.module.css";
import logger from "../../utils/server/logger";

const audience = getAudience("tms-min-side-proxy");
const oboToken = await getOboToken(Astro.locals.token, audience);

let data = { navn: "", ident: "" };
let isError = false;

try {
  data = await fetchData(oboToken, navnUrl);
} catch (error: any) {
  logger.error(`Fetching navn failed. ${error.message}`);
  isError = true;
}
---

{isError && <ClientError client:only="react" />}
<span class:list={["notranslate", style.navn]}>{data.navn ? data.navn.toLowerCase() : data.ident}</span>
